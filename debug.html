<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - å¼€äº‘æ”¯ä»˜</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .debug-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .info { background: #d1ecf1; color: #0c5460; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        #console-output {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>ğŸ” å¼€äº‘æ”¯ä»˜ - è°ƒè¯•é¡µé¢123</h1>
        
        <div class="status info">
            <strong>è°ƒè¯•ä¿¡æ¯ï¼š</strong> è¿™ä¸ªé¡µé¢ç”¨äºè¯Šæ–­åº”ç”¨é—®é¢˜
        </div>

        <h2>ç¯å¢ƒæ£€æµ‹</h2>
        <div id="env-info">
            <div class="status warning">æ­£åœ¨æ£€æµ‹ç¯å¢ƒ...</div>
        </div>

        <h2>Vue åº”ç”¨æµ‹è¯•</h2>
        <div id="vue-test">
            <div class="status warning">æ­£åœ¨æµ‹è¯• Vue...</div>
        </div>

        <h2>è·¯ç”±æµ‹è¯•</h2>
        <div id="router-test">
            <div class="status warning">æ­£åœ¨æµ‹è¯•è·¯ç”±...</div>
        </div>

        <h2>æ§åˆ¶å°è¾“å‡º</h2>
        <div id="console-output"></div>

        <h2>æ“ä½œ</h2>
        <button onclick="testVue()">æµ‹è¯• Vue</button>
        <button onclick="testRouter()">æµ‹è¯•è·¯ç”±</button>
        <button onclick="testStore()">æµ‹è¯• Store</button>
        <button onclick="testEnvVars()">æµ‹è¯•ç¯å¢ƒå˜é‡</button>
        <button onclick="clearConsole()">æ¸…ç©ºæ§åˆ¶å°</button>
        <button onclick="location.reload()">åˆ·æ–°é¡µé¢</button>
        
        <div id="env-test"></div>
    </div>

    <script>
        // é‡å†™ console.log æ¥æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š
        const originalLog = console.log;
        const originalError = console.error;
        const consoleOutput = document.getElementById('console-output');
        
        function addToConsole(message, type = 'log') {
            const div = document.createElement('div');
            div.style.color = type === 'error' ? 'red' : 'black';
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            consoleOutput.appendChild(div);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        console.log = function(...args) {
            originalLog.apply(console, args);
            addToConsole(args.join(' '), 'log');
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            addToConsole(args.join(' '), 'error');
        };

        // ç¯å¢ƒæ£€æµ‹
        function checkEnvironment() {
            const envInfo = document.getElementById('env-info');
            let html = '<div class="status success">âœ… ç¯å¢ƒæ£€æµ‹å®Œæˆ</div>';
            
            // æ£€æŸ¥åŸºæœ¬ç¯å¢ƒ
            html += `<p><strong>User Agent:</strong> ${navigator.userAgent}</p>`;
            html += `<p><strong>URL:</strong> ${window.location.href}</p>`;
            html += `<p><strong>Protocol:</strong> ${window.location.protocol}</p>`;
            
            // æ£€æŸ¥æ˜¯å¦åœ¨ Tauri ç¯å¢ƒä¸­
            if (window.__TAURI__) {
                html += '<div class="status success">âœ… æ£€æµ‹åˆ° Tauri ç¯å¢ƒ</div>';
            } else {
                html += '<div class="status warning">âš ï¸ æœªæ£€æµ‹åˆ° Tauri ç¯å¢ƒï¼ˆæ­£å¸¸ï¼Œåœ¨æµè§ˆå™¨ä¸­è¿è¡Œï¼‰</div>';
            }
            
            // æ£€æŸ¥ Vite ç¯å¢ƒå˜é‡ï¼ˆé€šè¿‡ process.env æ£€æµ‹ï¼‰
            html += '<div class="status info">â„¹ï¸ è°ƒè¯•é¡µé¢æ— æ³•ç›´æ¥è®¿é—® import.meta</div>';
            html += '<p>è¿™æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºè°ƒè¯•é¡µé¢æ˜¯ç‹¬ç«‹çš„ HTML æ–‡ä»¶</p>';
            html += '<p>ç¯å¢ƒå˜é‡é€šè¿‡ Vite çš„ define é…ç½®æ³¨å…¥åˆ° process.env ä¸­</p>';
            
            // æ£€æŸ¥ process.env å˜é‡ï¼ˆé€šè¿‡ Vite define å®šä¹‰ï¼‰
            html += '<h3>Process.env å˜é‡ï¼ˆé€šè¿‡ Vite define å®šä¹‰ï¼‰</h3>';
            if (typeof process !== 'undefined' && process.env) {
                html += '<div class="status success">âœ… æ£€æµ‹åˆ° process.env</div>';
                html += `<p><strong>NODE_ENV:</strong> ${process.env.NODE_ENV || 'undefined'}</p>`;
                html += `<p><strong>VUE_APP_CLIENT_SOCKET:</strong> ${process.env.VUE_APP_CLIENT_SOCKET || 'undefined'}</p>`;
                html += `<p><strong>VUE_APP_CLIENT_API:</strong> ${process.env.VUE_APP_CLIENT_API || 'undefined'}</p>`;
                html += `<p><strong>VUE_APP_PUBLIC_KEY:</strong> ${process.env.VUE_APP_PUBLIC_KEY ? 'å·²å®šä¹‰ï¼ˆé•¿åº¦: ' + process.env.VUE_APP_PUBLIC_KEY.length + 'ï¼‰' : 'undefined'}</p>`;
                html += `<p><strong>PATH_INDEX_PIC:</strong> ${process.env.PATH_INDEX_PIC || 'undefined'}</p>`;
            } else {
                html += '<div class="status error">âŒ æœªæ£€æµ‹åˆ° process.env</div>';
            }
            
            envInfo.innerHTML = html;
        }

        // æµ‹è¯• Vue
        window.testVue = function() {
            const vueTest = document.getElementById('vue-test');
            
            try {
                // æ£€æŸ¥ Vue æ˜¯å¦åŠ è½½
                if (typeof Vue !== 'undefined') {
                    vueTest.innerHTML = '<div class="status success">âœ… Vue å·²åŠ è½½</div>';
                    console.log('Vue version:', Vue.version);
                } else {
                    vueTest.innerHTML = '<div class="status error">âŒ Vue æœªåŠ è½½</div>';
                    console.error('Vue is not defined');
                }
            } catch (error) {
                vueTest.innerHTML = `<div class="status error">âŒ Vue æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
                console.error('Vue test error:', error);
            }
        }

        // æµ‹è¯•è·¯ç”±
        window.testRouter = function() {
            const routerTest = document.getElementById('router-test');
            
            try {
                // è¿™é‡Œéœ€è¦ç­‰å¾… Vue åº”ç”¨åŠ è½½
                setTimeout(() => {
                    if (window.vueApp && window.vueApp.$router) {
                        routerTest.innerHTML = '<div class="status success">âœ… è·¯ç”±å·²åŠ è½½</div>';
                        console.log('Current route:', window.vueApp.$route);
                    } else {
                        routerTest.innerHTML = '<div class="status error">âŒ è·¯ç”±æœªåŠ è½½</div>';
                        console.error('Router not found');
                    }
                }, 1000);
            } catch (error) {
                routerTest.innerHTML = `<div class="status error">âŒ è·¯ç”±æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
                console.error('Router test error:', error);
            }
        }

        // æµ‹è¯• Store
        window.testStore = function() {
            try {
                if (window.vueApp && window.vueApp.$store) {
                    console.log('Store state:', window.vueApp.$store.state);
                } else {
                    console.error('Store not found');
                }
            } catch (error) {
                console.error('Store test error:', error);
            }
        }

        // æµ‹è¯•ç¯å¢ƒå˜é‡
        window.testEnvVars = function() {
            const envTest = document.getElementById('env-test');
            
            try {
                let html = '<h4>ç¯å¢ƒå˜é‡æµ‹è¯•ç»“æœï¼š</h4>';
                
                // æµ‹è¯• process.env
                if (typeof process !== 'undefined' && process.env) {
                    html += '<div class="status success">âœ… process.env å¯ç”¨</div>';
                    html += `<p><strong>NODE_ENV:</strong> ${process.env.NODE_ENV || 'undefined'}</p>`;
                    html += `<p><strong>VUE_APP_CLIENT_SOCKET:</strong> ${process.env.VUE_APP_CLIENT_SOCKET || 'undefined'}</p>`;
                    html += `<p><strong>VUE_APP_CLIENT_API:</strong> ${process.env.VUE_APP_CLIENT_API || 'undefined'}</p>`;
                    html += `<p><strong>PATH_INDEX_PIC:</strong> ${process.env.PATH_INDEX_PIC || 'undefined'}</p>`;
                } else {
                    html += '<div class="status error">âŒ process.env ä¸å¯ç”¨</div>';
                }
                
                // æµ‹è¯• window å¯¹è±¡ä¸Šçš„å…¨å±€å˜é‡
                if (window.VUE_APP_CLIENT_SOCKET) {
                    html += '<div class="status success">âœ… å…¨å±€å˜é‡å¯ç”¨</div>';
                    html += `<p><strong>VUE_APP_CLIENT_SOCKET:</strong> ${window.VUE_APP_CLIENT_SOCKET}</p>`;
                } else {
                    html += '<div class="status warning">âš ï¸ å…¨å±€å˜é‡ä¸å¯ç”¨</div>';
                }
                
                envTest.innerHTML = html;
            } catch (error) {
                envTest.innerHTML = `<div class="status error">âŒ ç¯å¢ƒå˜é‡æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
                console.error('Env test error:', error);
            }
        }

        // æ¸…ç©ºæ§åˆ¶å°
        window.clearConsole = function() {
            consoleOutput.innerHTML = '';
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Debug page loaded');
            checkEnvironment();
            
            // ç›‘å¬é”™è¯¯
            window.addEventListener('error', function(e) {
                console.error('Global error:', e.error);
            });
            
            // ç›‘å¬æœªå¤„ç†çš„ Promise æ‹’ç»
            window.addEventListener('unhandledrejection', function(e) {
                console.error('Unhandled promise rejection:', e.reason);
            });
        });
    </script>
</body>
</html>
